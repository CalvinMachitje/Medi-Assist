{% extends "base.html" %}
{% block title %}Reception Dashboard - Medi-Assistâ„¢{% endblock %}
{% block styles %}
    <link rel="stylesheet" href="{{ url_for('static', filename='css/reception.css') }}?v=1">
{% endblock %}
{% block content %}
<div class="dashboard-content reception-dashboard">
    <h2 class="text-3xl font-bold mb-8">Reception Dashboard</h2>

    <details class="overview-panel" open>
        <summary class="text-xl font-semibold cursor-pointer">System Overview</summary>
        <div class="panel-content mt-4">
            <ul class="space-y-2 list-disc list-inside">
                <li><strong>Appointments Today:</strong> <span id="appointments-today">{{ patients_today|length }}</span></li>
                <li><strong>Total Visits (This Month):</strong> {{ all_visits|default(0) }}</li>
                <li><strong>Available Staff:</strong> {{ available_staff|length }}</li>
                <li><strong>Walk-in Patients Waiting:</strong> {{ walkins_waiting|length }}</li>
                <li><strong>Missed Appointments:</strong> {{ missed_appointments|length }}</li>
                <li><strong>Pending Patient Registrations:</strong> {{ pending_registrations|length }}</li>
            </ul>
        </div>
    </details>

    <section class="appointments-table" aria-labelledby="appointments-heading">
        <h3 id="appointments-heading" class="text-xl font-semibold mb-4">Today's Appointments</h3>
        <div class="form-group mb-4">
            <label for="sort-appointments" class="block mb-1 font-medium">Sort By</label>
            <select id="sort-appointments" class="form-control max-w-xs" aria-controls="appointments-table">
                <option value="all">All Appointments</option>
                <option value="scheduled">Scheduled Appointments</option>
                <option value="cancelled">Cancelled Appointments</option>
                <option value="today">Today's Appointments</option>
                <option value="week">This Week's Appointments</option>
                <option value="month">This Month's Appointments</option>
            </select>
        </div>
        {% if waiting_patients %}
        <table id="appointments-table" class="table" role="table">
            <thead>
                <tr>
                    <th scope="col">Patient ID</th>
                    <th scope="col">Patient Name</th>
                    <th scope="col">Appointment Time</th>
                    <th scope="col">Reason</th>
                    <th scope="col">Status</th>
                    <th scope="col">Helped By</th>
                    <th scope="col">Role</th>
                    <th scope="col">Action</th>
                </tr>
            </thead>
            <tbody id="waiting-patients-table-body">
                {% for patient in waiting_patients %}
                <tr data-appointment-id="{{ patient.id }}">
                    <td>{{ patient.patient_id }}</td>
                    <td>{{ patient.first_name }} {{ patient.last_name }}</td>
                    <td>{{ patient.appointment_date }}</td>
                    <td>{{ patient.reason|default('Not specified') }}</td>
                    <td class="capitalize">{{ patient.status }}</td>
                    <td>{{ patient.helper_name|default('N/A') }}</td>
                    <td>{{ patient.helper_role|default('N/A') }}</td>
                    <td>
                        {% if patient.status == 'scheduled' %}
                        <form action="{{ url_for('cancel_appointment') }}" method="POST" class="inline">
                            <input type="hidden" name="appointment_id" value="{{ patient.id }}">
                            <button type="submit" class="btn btn-danger" aria-label="Cancel appointment for {{ patient.first_name }} {{ patient.last_name }}">Cancel</button>
                        </form>
                        {% else %}
                        <span class="text-gray-600">{{ patient.status|capitalize }}</span>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
        <p class="text-center text-gray-600">No waiting patients today.</p>
        {% endif %}
    </section>

    <section class="daily-summary" aria-labelledby="summary-heading">
        <h3 id="summary-heading" class="text-xl font-semibold mb-4">Today's Summary</h3>
        <ul class="space-y-2 list-disc list-inside">
            <li><strong>Patients Checked-in:</strong> {{ checked_in_patients|default(0) }}</li>
            <li><strong>Walk-ins Processed:</strong> {{ walkins_processed|default(0) }}</li>
            <li><strong>Appointments Rescheduled:</strong> {{ appointments_rescheduled|default(0) }}</li>
            <li><strong>Payments Processed:</strong> {{ payments_processed|default(0) }}</li>
        </ul>
    </section>

    <details class="notifications-panel" open>
        <summary class="text-xl font-semibold cursor-pointer">Notifications</summary>
        <div class="panel-content mt-4" role="list" aria-label="Notifications">
            {% if notifications %}
            <ul class="space-y-4">
                {% for note in notifications %}
                <li class="border-b pb-2" role="listitem">
                    <strong>{{ note.title }}</strong> - {{ note.message }}
                    <small class="text-gray-500 ml-2">({{ note.timestamp }})</small>          
                </li>
                {% endfor %}
            </ul>
            {% else %}
            <p class="text-center text-gray-600">No new notifications.</p>
            {% endif %}
        </div>
    </details>
</div>
{% endblock %}